{% extends 'AdminBundle:Default:index.html.twig' %}

{% block nav %}
    <div class="collection emp-nav">
        <a href="{{ path('admin_homepage') }}" class="collection-item"><i class="material-icons nav-icon">reorder</i> Home</a>
        <a href="{{ path('profile_page') }}" class="collection-item"><i class="material-icons nav-icon">perm_identity</i> Profile</a>
        <!-- <a href="notif.html" class="collection-item"><i class="material-icons nav-icon">chat_bubble_outline</i> Notification <span class="new badge">2</span></a> -->

    </div>

    <div class="collection admin-nav">
        {#<a href="vl.html" class="collection-item"><i class="material-icons nav-icon">view_agenda</i> View Requests <span class="new badge">1</span></a>#}
        {% if role == 'ADMIN' %}
            <a href="{{ path('manage_employee') }}" class="collection-item active"><i class="material-icons nav-icon">list</i> Manage Employees</a>
        {% endif %}
    </div>

    <div class="collection logout-nav">
        <a href="#!" class="collection-item btn-logout"><i class="material-icons nav-icon">input</i> Log out</a>
    </div>
{% endblock %}

{% block body %}
<section id="main-container">
 
    <section id="main-wrapper">
        <div class="container-fluid">
        <div class="row">

            <div class="page-content">
                <div class="col-md-12 light-blue darken-1 heading z-depth-1">
                    <div class="responsive-nav"><a class="btn-flat"><i class="material-icons res-menu">reorder</i></a></div>
                    <h3 class="center-align">Manage Employees</h3>
                    {#<div class="center-align nav-menu" style="margin-top: 20px;">#}
                        {#<a href="#" class="waves-effect waves-light btn green btn-export modal-trigger view-emp-btn" style="color: white;">View Employees</a>#}
                        {#<a href="#" class="waves-effect waves-light btn green btn-export modal-trigger view-time-btn" style="color: white;">View Time logs</a>#}
                        {#<a href="#" class="waves-effect waves-light btn green btn-export modal-trigger" style="color: white;">View Requests</a>#}
                    {#</div>#}
                    <div class="top-nav" style="margin-top: 20px;">
                        <a class="waves-effect waves-light btn orange btn-export modal-trigger modal-export" href="#exportchoice">Export</a>
                    </div>
                </div>


    {{ include ('AdminBundle:Default:manageemployees.html.twig') }}
    {{ include ('AdminBundle:Default:managetime.html.twig') }}
            </div>
        {#<div class="page-content">#}
            {#<div class="col-md-12 light-blue darken-1 heading z-depth-1">#}
            {#<div class="responsive-nav"><a class="btn-flat"><i class="material-icons res-menu">reorder</i></a></div>#}
                {#<h3 class="center-align">Employees</h3>#}
                {#<div class="center-align nav-menu" style="margin-top: 20px;">#}
                {#<a href="{{ path('manage_employee') }}" class="waves-effect waves-light btn btn-export modal-trigger" style="color: white;">View Employees</a>#}
                {#<a href="#" class="waves-effect waves-light btn green btn-export modal-trigger" style="color: white;">View Time logs</a>#}
                {#<a href="#" class="waves-effect waves-light btn green btn-export modal-trigger" style="color: white;">View Requests</a>#}
                {#</div>#}
            {#<div class="top-nav" style="margin-top: 20px;">#}
                {#<a class="waves-effect waves-light btn orange btn-export modal-trigger modal-export" href="#exportchoice">Export</a>#}
            {#</div>#}
        {#</div>#}

        {#<div class="col-md-12 content">#}
            {#<div class="row" style="margin-left:5px;">#}
                {#<table class="bordered highlight emp-list">#}
                    {#<thead>#}
                          {#<tr>#}
                              {#<th data-field="id">Employee Number</th>#}
                              {#<th data-field="name">Name</th>#}
                              {#<th data-field="price">Department</th>#}
                              {#<th data-field="price">Position</th>#}
                              {#<th data-field="price">Status</th>#}
                          {#</tr>#}
                    {#</thead>#}

                     {#<tbody>#}
                        {#{% for emp in getEmployee %}#}
                            {#{% if emp.getProfileStatus == 0 %}#}
                                {#{% if emp.EmpAcc.getRole == 'employee' %}#}
                          {#<tr class="empProfile" data-empid="{{emp.getEmpAccAccId}}">#}
                            {#<td>{{emp.getEmployeeNumber}}</td>#}
                            {#<td>{{emp.EmpAcc.getEmpProfiles[0].fname ~ ' ' ~ emp.EmpAcc.getEmpProfiles[0].lname}}</td>#}
                            {#<td>{{emp.getListDept().DeptNames}}</td>#}
                            {#<td>{{emp.getListPos().PosNames}}</td>#}
                            {#<td>{{emp.getStatus}}</td>#}
                          {#</tr>#}
                                {#{% endif %}#}
                            {#{% endif %}#}
                          {#{% endfor %}#}
                      {#</tbody>#}
                {#</table>#}
            {#</div>                  #}
        {#</div>#}
        {#</div>#}

        {#<div class="page-content">#}
            {#<div class="col-md-12 light-blue darken-1 heading z-depth-1">#}
            {#<div class="responsive-nav"><a class="btn-flat"><i class="material-icons res-menu">reorder</i></a></div>#}
                {#<h3 class="center-align">Employees</h3>#}
            {#<div class="top-nav">#}
                {#<a class="waves-effect waves-light btn orange btn-export modal-trigger modal-export" href="#exportchoice">Export</a>#}
            {#</div>#}
        {#</div>#}

        {#<div class="col-md-12 content">#}
            {#<div class="row" style="margin-left:5px;">#}
                {#<table class="bordered highlight emp-list">#}
                    {#<thead>#}
                          {#<tr>#}
                              {#<th data-field="id">Employee Number</th>#}
                              {#<th data-field="name">Name</th>#}
                              {#<th data-field="price">Department</th>#}
                              {#<th data-field="price">Position</th>#}
                              {#<th data-field="price">Status</th>#}
                          {#</tr>#}
                    {#</thead>#}

                     {#<tbody>#}
                        {#{% for emp in getEmployee %}#}
                            {#{% if emp.getProfileStatus == 0 %}#}
                                {#{% if emp.EmpAcc.getRole == 'employee' %}#}
                          {#<tr class="empProfile" data-empid="{{emp.getEmpAccAccId}}">#}
                            {#<td>{{emp.getEmployeeNumber}}</td>#}
                            {#<td>{{emp.EmpAcc.getEmpProfiles[0].fname ~ ' ' ~ emp.EmpAcc.getEmpProfiles[0].lname}}</td>#}
                            {#<td>{{emp.getListDept().DeptNames}}</td>#}
                            {#<td>{{emp.getListPos().PosNames}}</td>#}
                            {#<td>{{emp.getStatus}}</td>#}
                          {#</tr>#}
                                {#{% endif %}#}
                            {#{% endif %}#}
                          {#{% endfor %}#}
                      {#</tbody>#}
                {#</table>#}
            {#</div>                  #}
        {#</div>#}
        </div>
        {#<div class="fixed-action-btn horizontal click-to-toggle" style="bottom: 45px; right: 24px;">#}
            {#<a class="btn-floating btn-large red">#}
            {#<i class="material-icons">add</i>#}
            {#</a>#}
            {#<ul class="add">#}
                {#<li><a class="modal-trigger modal-emp waves-effect waves-light orange btn-floating btn-emp" href="#modal-emp">employee</a></li>#}
                {#<li><a class="modal-trigger modal-pos waves-effect waves-light orange btn-floating btn-pos" href="#modal-pos">position</a></li>#}
                {#<li><a class="modal-trigger modal-dept waves-effect waves-light orange btn-floating btn-dept" href="#modal-dept">department</a></li>#}
            {#</ul>#}
        {#</div>#}

        <div id="modal-emp" class="modal modal-fixed-footer">
            <form form action="{{ path('add_employee') }}" method="post">
            <div class="modal-content">
            <h4>Employee</h4>
            <p>Username<input name = "username" placeholder="type here..." id="empnum" type="text" class="input-field"></p>
            <p>Password<input name = "password" placeholder="type here..." id="fname" type="password" class="input-field"></p>
            <p>Re-type Password<input name = "repassword" placeholder="type here..." id="fname" type="password" class="input-field"></p>
            <br>
            <p>Employee #<input name = "empnum" placeholder="type here..." id="empnum" type="text" class="input-field"></p>
            <p>First Name<input name = "fname" placeholder="type here..." id="fname" type="text" class="input-field"></p>
            <p>Last Name<input name = "lname" placeholder="type here..." id="lname" type="text" class="input-field"/></p>
            <p>Department</p>
            <div class="select-wrapper"><span class="caret">?</span>
                    <select name="dept" id="dept" class="initialized emp-dept">
                            <option value="" disabled selected>Select department</option>
                            {% for dept in getDept %}
                            <option value="{{dept.Id}}" data-id="{{dept.Id}}" class="deptid">{{dept.DeptNames}}</option>
                            {% endfor %}
                    </select>
            </div>

                <p>Position</p>
                <div class="select-wrapper"><span class="caret">?</span>
                    <select name="pos"id="pos" class="initialized emp-positions">
                        <option value="" disabled selected>Select position</option>
                        {% for pos in getPos %}
                        <option value="{{pos.Id}}">{{pos.PosNames}}</option>
                        {% endfor %}
                    </select>
                </div>

                <p>Employment Status</p>
                <div class="select-wrapper"><span class="caret">?</span>
                    <select name="status"id="status" class="initialized emp-status">
                        <option value="" disabled selected>Select status</option>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contractual">Contractual</option>
                        <option value="Provisionary">Provisionary</option>
                        <option value="Home-based">Home-based</option>
                        <option value="Intern">Intern</option>
                    </select>
                </div>
                    <br>
            <p>Company Email<input name="email" placeholder="type here..." id="full_name" type="text" class="input-field"></p>
            <p>Telephone #<input name="telnum" placeholder="type here..." id="full_name" type="text" class="input-field"></p>
            <p>Cellphone #<input name="cellnum" placeholder="type here..." id="full_name" type="text" class="input-field"></p>
            <p>Address<input name="address" placeholder="type here..." id="full_name" type="text" class="input-field"></p>
            <p>Birthday<input name="bday" placeholder="type here..." id="full_name" type="date" class="input-field"></p>
            <p>SSS<input placeholder="type here..." id="full_name" type="text" class="input-field"></p>
            <p>BIR<input placeholder="type here..." id="full_name" type="text" class="input-field"></p>
            <p>PhilHealth<input placeholder="type here..." id="full_name" type="text" class="input-field"></p>

            </div>
            <div class="modal-footer">
                <input type=submit value="add" class="modal-action modal-close waves-effect waves-green btn-flat addemp"></input>
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel</a>
            </div>
            </form>
        </div>

        <div id="modal-pos" class="modal modal-fixed-footer">
            <div class="modal-content">
                <h4>Position</h4>
                <input placeholder="type position here..." id="input-position" type="text">
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat addpos">Add</a>
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel</a>
            </div>
        </div>

        <div id="modal-dept" class="modal modal-fixed-footer">
            <div class="modal-content">
                <h4>Department</h4>
                <input placeholder="type department here..." id="input-department" type="text" >
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat adddept">Add</a>
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel</a>
            </div>
        </div>
            <div id="exportchoice" class="modal">
                <div class="modal-content">
                    <h4>Export</h4>

                    <p>Choose entity: </p>
                    <form action="#">
                        <input name="group1" type="radio" id="all-emp" class="export-radio-input" checked/>
                        <label for="all-emp" class="lbl-info radio-lbl">All Employees</label>

                        <input name="group1" type="radio" id="select-dept" class="export-radio-input"/>
                        <label for="select-dept" class="lbl-info radio-lbl">Select by Department</label>

                        <div class= "selectDept">
                            <select id = "listdept" style="display:block; margin-top: 10px;">
                                <option value="" disabled selected>Choose your department</option>
                                <option value="1">Executive</option>
                                <option value="2">Graphics</option>
                                <option value="3">Development</option>
                                <option value="4">SEO</option>
                                <option value="5">Content</option>
                                <option value="6">Social Media</option>
                                <option value="7">Admin</option>
                                <option value="8">Maintenance</option>
                            </select>
                        </div>
                        <div class="row" style="margin-top: 10px;">


                            <div class="col-md-6">
                                <label class="label">From:</label>
                                <input name="start-date" placeholder="Start Date" class="start-date"
                                       type="text"onblur="(this.type='text')" onfocus="(this.type='date')">
                            </div>
                            <div class="col-md-6">
                                <label class="label">To:</label>
                                <input name="end-date" placeholder="End Date" class="end-date"
                                       type="text"onblur="(this.type='text')" onfocus="(this.type='date')">

                            </div>
                        </div>
                        <div class="modal-footer">
                        <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
                        <a class="modal-action waves-effect waves-green btn-flat export-submit-btn">Export</a>
                        </div>
                        {#<div class="modal-footer">#}
                            {##}
                            {#<a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat btn-exportfiles export-submit-btnC">Export</a>#}

                        {#</div>#}
                    </form>

                        </div>
                    </div>



                    {#<p>Choose file/s to export:</p>#}
                    {#<form action="#" class="cbox-file">#}
                        {#<input type="checkbox" id="profile" />#}
                        {#<label for="profile" class="lbl-info">Profile</label>#}
                        {#<input type="checkbox" id="contact" />#}
                        {#<label for="contact" class="lbl-info">Telephone/Cellphone</label>#}
                        {#<input type="checkbox" id="govt" />#}
                        {#<label for="govt" class="lbl-info">SSS/BIR/PhilHealth</label>#}
                        {#<input type="checkbox" id="logs" />#}
                        {#<label for="logs" class="lbl-info">Time-In/Time-Out Logs</label>#}
                        {#<br><br>#}


                    {#</form>#}


        <!-- EMPLOYEE MODAL ONCLICK -->
        {#<div id="testmodal" class="modal modal-fixed-footer">#}
            {#<div class="modal-content">#}
            {#<h4>Employee</h4>#}
            {#<p><b>Employee #</b></p>#}
            {#<p id = "empnumber"></p><hr>#}
            {#<p><b>First Name</b></p>#}
            {#<p id = "fname-p"></p><hr>#}
            {#<p><b>Last Name</b></p>#}
            {#<p id = "lname-p"></p><hr>#}
            {#<p><b>Department</b></p>#}
            {#<p id = "depart-p"></p><hr>#}
            {#<p><b>Position</b></p>#}
            {#<p id = "post-p"></p><hr>#}
            {#<p><b>Employment Status</b></p>#}
            {#<p id = "stat-p"></p><hr>#}
            {#<p><b>Company Email</b></p>#}
            {#<p id = "email-p"></p><hr>#}
            {#<p><b>Telephone #</b></p>#}
            {#<p id = "tel-p"></p><hr>#}
            {#<p><b>Cellphone #</b></p>#}
            {#<p id = "cel-p"></p><hr>#}
            {#<p><b>Address</b></p>#}
            {#<p id = "add-p"></p><hr>#}
            {#<p><b>Birthday</b></p>#}
            {#<p id = "bday-p"></p><hr>#}


            {#</div>#}
            {#<div class="modal-footer">#}
                {#<a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Update</a>#}
                {#<a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Delete</a>#}
                {#<a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Close</a>#}
            {#</div>#}
        {#</div>#}
    </section>
</section>
{% endblock %}

{% block scripts %}
   {{  parent() }}
{% endblock %}
{% block customjs %}
<script type="text/javascript">
$(document).ready(function(){
    var inputfield = '';
    var empId = '';
    $('.btn-cancel-input').click(function(e){
        e.preventDefault();

                $('#input-department').val('');
                $('#input-position').val('');
                $('.input-field').closest('.profile-data').find('input[type=text]').val('');
                $('.input-field').closest('.profile-data').find('input[type=text]').css({'border-bottom-color' : '#9e9e9e'})
        });

            
        $("#upload-photo").change(function () {
            var fileExtension = ['jpeg', 'jpg', 'png'];
    });


    $('.birth-date').pickadate({
        selectMonths: true,
        selectYears: 15
    });

    $('.addpos').click(function(){
            inputfield=$('#input-position').val();
            $.get("{{ path('add_position') }}" + inputfield,  function(data){
                console.log(data);
            }, "json"); 
        });

    $('.adddept').click(function(){
            inputfield=$('#input-department').val();
            $.get("{{ path('add_department') }}" + inputfield,  function(data){
                console.log(data);
            }, "json"); 
            $('#input-department').val('');
        });
    $('.empProfile').click(function(){

        empId = $(this).data('empid');
        window.location.href = '{{ path('emp_page')}}' + empId;
    });

    $('.export-submit-btn').click(function(){
        var deptid = $('#listdept').val();
        var start  = new Date($('[name=start-date]').val());
        var end    = new Date($('[name=end-date]').val());
        var isDate = start == 'Invalid Date' ? 0 : 1;
        var s = start.getDate();
        var e = end.getDate();

        start   = start.toDateString();
        end     = end.toLocaleString();

//        if(start == 'Invalid Date' || end == 'Invalid Date'){
//            if(start == 'Invalid Date'){
//                $('.start-date').css({'border-color' : 'red'});
//                setTimeout(function(){
//                    $('.start-date').css({'border-color' : 'gray'});
//                }, 500);
//            }
//            if(end == 'Invalid Date'){
//                $('.end-date').css({'border-color' : 'red'});
//                setTimeout(function(){
//                    $('.end-date').css({'border-color' : 'gray'});
//                }, 500);
//            }
//            return;
//        }
//        if(start == 'Invalid Date' || end == 'Invalid Date'){
//            if(start == 'Invalid Date'){
//                $('.start-date').css({'border-color' : 'red'});
//                setTimeout(function(){
//                    $('.start-date').css({'border-color' : 'gray'});
//                }, 500);
//            }
//            if(end == 'Invalid Date'){
//                $('.end-date').css({'border-color' : 'red'});
//                setTimeout(function(){
//                    $('.end-date').css({'border-color' : 'gray'});
//                }, 500);
//            }
//            return;
//        }
        if(s > e){
            alert('End date must be higher');
            return;
        }
        $('[name=start-date]').val('');
        $('[name=end-date]').val('');
        if ($('#select-dept:checked').length){
            if(deptid == null){
                $('#listdept').css({'color' : 'red'});
                setTimeout(function(){
                    $('#listdept').css({'color' : 'black'});
                }, 500);
               return;
            }
        }
        $('#exportchoice').closeModal();
        window.open("{{ path('admin_employee_report') }}?deptid=" + deptid + '&start='
            + start + '&end=' + end
            + '&isDate=' + isDate, '_blank');
    });

    $('.view-emp-btn').click(function(){
        $('.managetime-content').hide();
        $('.manageemployees-content').show();
    });

    $('.view-time-btn').click(function(){
        $('.managetime-content').show();
        $('.manageemployees-content').hide();
    });

});

</script>
{% endblock %}
