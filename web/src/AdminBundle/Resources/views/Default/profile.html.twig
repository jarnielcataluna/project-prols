{% extends 'AdminBundle:Default:index.html.twig' %}
{% import 'AdminBundle:Default:notification.html.twig' as notif %}
{% block head %}
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.1.min.js"></script>

    {{ parent() }}
{% endblock %}

        {% block nav %}
            <div class="collection emp-nav">
                <a href="{{ path('admin_homepage') }}" class="collection-item"><i class="material-icons nav-icon">reorder</i> Home</a>
                <a href="{{ path('profile_page') }}" class="collection-item active"><i class="material-icons nav-icon">perm_identity</i> Profile</a>
                <!-- <a href="notif.html" class="collection-item"><i class="material-icons nav-icon">chat_bubble_outline</i> Notification <span class="new badge">2</span></a> -->

            </div>

            <div class="collection admin-nav">
                {#<a href="vl.html" class="collection-item"><i class="material-icons nav-icon">view_agenda</i> View Requests <span class="new badge">1</span></a>#}
                {% if role == 'ADMIN' %}
                    <a href="{{ path('manage_employee') }}" class="collection-item"><i class="material-icons nav-icon">list</i> Manage Employees</a>
                    <a href="{{ path('view_request') }}" class="collection-item"><i class="material-icons nav-icon">view_agenda</i> View Requests {% if requestcount != 0 %}<span class="new badge">{{ requestcount }}</span>{% endif %}</a>
                {% endif %}
            </div>

            <div class="collection logout-nav">
                <a href="#!" class="collection-item btn-logout"><i class="material-icons nav-icon">input</i> Log out</a>
            </div>
        {% endblock %}

        {% block body %}
            <div class="col-md-12 green center-align changepass-notif light-green darken-1 close-alert notification-modal">
                <div class="timein-success"><h5>Password Changed!</h5></div>
            </div>

            {{ notif.notif_loader() }}

            <div class="page-content">
                <div class="col-md-12 light-blue darken-1 heading z-depth-1">
                    <div class="responsive-nav"><a class="btn-flat"><i class="material-icons res-menu">reorder</i></a></div>
                    <div class="emp-photo">
                        <div class="profile-image center-align">
                            <span>{{ propelrr.fname|slice(0,1)|upper }}</span>
                            <!-- <img src="img/dexterloor.jpg" alt="" class="circle responsive-img z-depth-1"> -->
                        </div>
                    </div>
                    <div class="profile-title"><h3>{{ propelrr.fname }} {{ propelrr.lname }}</h3>
                        <div class="editprofile-btns">
                            <!-- <a class="waves-effect waves-light btn orange btn-edit-profile">Edit</a>
                            <a class="waves-effect waves-light btn orange btn-save-profile">Save</a>
                            <a class="waves-effect waves-light btn orange btn-cancel-profile">Cancel</a> -->
                            <a class="waves-effect waves-light btn modal-trigger modal-change orange" href="#modal-changepw">Change Password</a>
                        </div>
                    </div>

                    <div id="modal-changepw" class="modal">
                        <div class="modal-content">
                            <h4>Change Password</h4>
                            <div class="chip" id="formchangedalert" style="display:none;">
                                <strong>Password Changed!</strong>
                            </div>
                            <form action="{{ path('change_pass') }}" id = "changepass" method="post">
                                <input id="oldpw" name = "inputpassword" type="password" placeholder="Enter old password...">
                                <input id="newpw" name = "password" type="password" placeholder="Enter new password...">
                                <input id="confirmpw" name = "conpassword" type="password" placeholder="Confirm your password...">

                        </div>
                        <div class="modal-footer">
                            <button type="submit" href="#!" class=" modal-action waves-effect waves-green btn-flat btn-changepw">Change</button>
                            </form>
                        </div>
                    </div>
                    <!-- <h3 class="center-align">Dexter Loor</h3>
                    <h6 class="center-align">001</h6>
                    <h6 class="center-align">Web Engineer</h6> -->

                    <!-- <div class="profile-info-left"> -->
                    <!--    <p class="label">Name<span class="data">Dexter Loor</span></p> -->
                    <!-- <p class="label">Employee Number</p>
                    <p class="label">Position</p>
                    <p class="label">Department</p>
                    <p class="label">Company Email</p>
                </div>
                <div class="profile-info-left">
                    <p class="data">001</p>
                    <p class="data">Web Software Engineer</p>
                    <p class="data">Tech</p>
                    <p class="data">dexter.loor@searchoptmedia.com</p>
                </div>



                <div class="profile-info-center">
                    <p class="label">Birthday</p>
                    <p class="label">Telephone</p>
                    <p class="label">Cellphone</p>
                    <p class="label">Address</p>
                </div>
                <div class="profile-info-center">
                    <p class="data">Jan 20 1990</p>
                    <p class="data"><i class="material-icons btn-edit">
                            <a href="#!" class="edit">mode_edit</a></i>
                            <input disabled value="8444159" type="text" id="tel-p" class="editable"></li></p>
                    <p class="data"><i class="material-icons btn-edit">
                            <a href="#!" class="edit">mode_edit</a></i><i class="material-icons done">done</i>
                            <input disabled value="9153481674" type="text" id="cel-p"  class="editable"></li></p>
                    <p class="data"><i class="material-icons btn-edit">
                            <a href="#!" class="edit">mode_edit</a></i><i class="material-icons done">done</i>
                            <input disabled value="Taguig City" type="text" id="addr" class="editable"></li></p>
                </div>

                <div class="profile-info-right">
                    <p class="label">SSS</p>
                    <p class="label">BIR</p>
                    <p class="label">Philhealth</p>
                    <p class="label">Address</p>
                </div>

                <div class="profile-info-right">
                    <p class="data">1234523423</p>
                    <p class="data">324252352352</p>
                    <p class="data">213124345436</p>
                    <p class="data">352452424333</p>
                </div>


                    <div class="editprofile-btns center-align" style="padding-bottom: 10px;">
                        <a class="waves-effect waves-light btn orange btn-edit-profile">Edit</a>
                        <a class="waves-effect waves-light btn orange btn-save-profile">Save</a>
                        <a class="waves-effect waves-light btn orange btn-cancel-profile">Cancel</a>
                    </div>

     -->
                    <div class="profile-container2">


                        <div class="empinfo-left">
                            <input value="{{ profileId }}" type="text" name="profileId" hidden>
                            <p><span class="p-lbl">Employee Number</span>:<span class="p-dta">{{empnumber}}</span></p>
                            <p><span class="p-lbl">Position</span>:<span class="p-dta">{{ posStatus }}</span> </p>
                            <p><span class="p-lbl">Department</span>:<span class="p-dta">{{deptnames}}</span></p>
                            <p><span class="p-lbl">Company Email</span>:<span class="p-dta">{{conEmail}}</span></p>
                        </div>


                        <div class="empinfo-middle">
                            <p><span class="p-lbl">Address</span>:<span class="p-dta"><input disabled value="{{ propelrr.address }}" type="text" id="addr" class="editable"><i class="material-icons edit-pdata">mode_edit</i></span></p>
                            <p><span class="p-lbl">Birthday</span>:<span class="p-dta">{{ propelrr.bday | date('M d Y')}}</span></p>
                            <p><span class="p-lbl">Telephone</span>:<span class="p-dta"><input disabled value="{{conTele}}" type="text" id="tel-p" class="editable"><i class="material-icons edit-pdata">mode_edit</i></span></p>
                            <p><span class="p-lbl">Cellphone</span>:<span class="p-dta"><input disabled value="{{conMobile}}" type="text" id="cel-p"  class="editable"><i class="material-icons edit-pdata">mode_edit</i></span></p>

                        </div>

                        <div class="empinfo-right">
                            <p><span class="p-lbl">SSS</span>:<span class="p-dta"></span></p>
                            <p><span class="p-lbl">BIR</span>:<span class="p-dta"></span> </p>
                            <p><span class="p-lbl">Philhealth</span>:<span class="p-dta"></span></p>
                        </div>


                    </div>

                </div>

                <!-- <div class="col-md-12 content">
                    <div class="col-md-4 profile">
                        <ul class="collection profile-info">
                            <li class="collection-item">Department<p class="p-dta">Developer</p></li>
                            <li class="collection-item">Company Email <p class="p-dta">dexter.loor@searchoptmedia.com</p></li>
                            <li class="collection-item">Birthday <p class="p-dta">01/01/01</p></li>
                        </ul>

                    </div>

                    <div class="col-md-4 profile">
                        <ul class="collection profile-info">
                            <li class="collection-item">Telephone <div class="chip required-field">required field!</div>
                            <i class="material-icons btn-edit">
                            <a href="#!" class="edit">mode_edit</a></i>
                            <input disabled value="8444159" type="text" id="tel-p" class="editable"></li>

                            <li class="collection-item">Cellphone <div class="chip required-field">required field!</div>
                            <i class="material-icons btn-edit">
                            <a href="#!" class="edit">mode_edit</a></i><i class="material-icons done">done</i>
                            <input disabled value="9153481674" type="text" id="cel-p"  class="editable"></li>

                            <li class="collection-item">Address <div class="chip required-field">required field!</div>
                            <i class="material-icons btn-edit">
                            <a href="#!" class="edit">mode_edit</a></i><i class="material-icons done">done</i>
                            <input disabled value="Taguig City" type="text" id="addr" class="editable"></li>
                        </ul>
                    </div>

                    <div class="col-md-4 profile">
                        <ul class="collection profile-info">
                            <li class="collection-item">SSS <p class="p-dta">12311231</p></li>
                            <li class="collection-item">BIR <p class="p-dta">213231</p></li>
                            <li class="collection-item">PhilHealth<p class="p-dta">1232131312</p></li>
                        </ul>
                    </div>
                </div> -->

                <!-- <div class="editprofile-btns center-align" style="padding-bottom: 10px;">
                    <a class="waves-effect waves-light btn orange btn-edit-profile">Edit</a>
                    <a class="waves-effect waves-light btn orange btn-save-profile">Save</a>
                    <a class="waves-effect waves-light btn orange btn-cancel-profile">Cancel</a>
                </div> -->


                <!-- <div class="col-md-12 profile">
                    <div id="perf-chart" class="demo-placeholder"  style="width:100%;height:400px"></div>
                        <table class="bordered responsive-table highlight centered">
                            <thead>
                                <tr>
                                    <th data-field="Date">Month</th>
                                    <th data-field="Absences">Absences</th>
                                    <th data-field="Lates">Lates</th>
                                    <th data-field="Overtimes">Overtimes</th>
                                    <th data-field="Out of IP">Out of IP</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td>Jan</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                </tr>
                                <tr>
                                    <td>Feb</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>6</td>
                                    <td>7</td>
                                </tr>
                                <tr>
                                    <td>Mar</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Apr</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>May</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Jun</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Jul</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Aug</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Sep</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Oct</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Nov</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>Dec</td>
                                    <td>8</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>9</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div> -->
            </div>
            </div>

        {% endblock %}
        {% block scripts %}
            <script type="text/javascript" src="{{asset('prols2/js/plugins/sparkline/jquery.sparkline.min.js')}}"></script>
            <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
            <script src="https://cdn.jsdelivr.net/jquery.validation/1.15.0/jquery.validate.min.js"></script>
            <script src="https://cdn.jsdelivr.net/jquery.validation/1.15.0/additional-methods.min.js"></script>

            {{ parent() }}
        {% endblock %}

{% block customjs %}
    <script type="text/javascript">
        $(document).ready(function(){
            var profileId = '';
            var contactid = '';
            var deptId = '';
            $('#emailedit').click(function(){
                profileId = $(this).data('eid');
                contactid=$('#email-p').val();

                $.get("{{ path('profile_email') }}" + profileId + "/" + contactid,  function(data){
                    console.log(data);
                }, "json");

            });
            $('#teledit').click(function(){
                profileId = $(this).data('tid');
                contactid=$('#tel-p').val();

                $.get("{{ path('profile_tele') }}" + profileId + "/" + contactid,  function(data){
                    console.log(data);
                }, "json");

            });

            $('#celledit').click(function(){
                profileId = $(this).data('cid');
                contactid=$('#cel-p').val();

                $.get("{{ path('profile_mobile') }}" + profileId + "/" + contactid,  function(data){
                    console.log(data);
                }, "json");

            });

            $('#addressedit').click(function(){
                profileId = $(this).data('aid');
                contactid=$('#addr').val();

                $.get("{{ path('profile_address') }}" + profileId + "/" + contactid,  function(data){
                    console.log(data);
                }, "json");

            });

            $('#bdayedit').click(function(){
                profileId = $(this).data('bid');
                contactid=$('#bday-p').val();

                $.get("{{ path('profile_bday') }}" + profileId + "/" + contactid,  function(data){
                    console.log(data);
                }, "json");

            });

            $('#deptedit').click(function(){
                profileId = $(this).data('did');
                contactid = deptId;
                $.get("{{ path('profile_dept') }}" + profileId + "/" + contactid,  function(data){
                    console.log(data);
                }, "json");

            });

            $('#dept').click(function(){
                console.log('test');
                //asdsa = $(this).attr('data-id');
                //console.log(asdsa);
            });


            // $('.update-btn').hide();
            // $('.cancel-btn').hide();
            // $('.delete-btn').hide();
            // $('.test-btn').click(function(){
            //     {% if role == 'ADMIN' %}
            //     $('.update-btn').show();
            //     $('.cancel-btn').show();
            //     $('.delete-btn').show();
            //     $('.test-btn').hide();

            //     $('#dept').attr("enabled", true);
            //     $('.collection-item').find('input').attr("disabled", false);
            //     $('.collection-item').find('.done').css({'display' : 'block'});
            //     $('.collection-item').find('.edit').css({'display' : 'none'});
            //     {% else %}
            //     $('.update-btn').show();
            //     $('.cancel-btn').show();
            //     $('.delete-btn').show();
            //     $('.test-btn').hide();
            //     $('#tel-p').attr("disabled", false);
            //     $('#cel-p').attr("disabled", false);
            //     $('#addr').attr("disabled", false);
            //     $('.collection-item').find('.done').css({'display' : 'block'});
            //     $('.collection-item').find('.edit').css({'display' : 'none'});
            //     {% endif %}
            // });
            // $('.cancel-btn').click(function(){
            //     $('.update-btn').hide();
            //     $('.cancel-btn').hide();
            //     $('.delete-btn').hide();
            //     $('.test-btn').show();
            //     $('.collection-item').find('input').attr("disabled", true);
            //     $('.collection-item').find('.done').css({'display' : 'none'});
            //     $('.collection-item').find('.edit').css({'display' : 'block'});
            // });


            $('.initialized').material_select();


            $('#changepass').on('submit', function() {
                $('#formchangedalert').hide();
                var oldpass = $('#oldpw').val();
                var newpass = $('#newpw').val();
                var conpass = $('#confirmpw').val();
                var error = false;
                if(oldpass == '' || newpass == '' || conpass == '' ){
                    error = true;
                    $('#formchangedalert').text('All fields required');
                    $('#formchangedalert').show();
                    $('.changepass-container').show();
                }
                else if(newpass != conpass){
                    error = true;
                    $('#formchangedalert').text('Password does not match');
                    $('#formchangedalert').show();
                }
                if(error) {
                    return false;
                }

                var data = {oldpass:oldpass, newpass:newpass};
                console.log(data);
                $('.loader-notif').show();
                $('.loader-notif').css({'top' : '0px'});
                var jqxhr = $.post( "{{ path('change_pass') }}", data, function(data) {
                    console.log(data);

                })
                        .done(function(data) {
                            var data = eval('('+ data +')');
                            if(data.error == true){

                            }else{
                                console.log(data);
                                $('#oldpw').val('');
                                $('#newpw').val('');
                                $('#confirmpw').val('');
                                $('.changepass-notif').css({'top' : '0px'});
                                $('#modal-changepw').css({'display' : 'none'});
                                $('.lean-overlay').css({'display' : 'none'});
                                setTimeout(function(){
                                    $('.changepass-notif').css({'top' : '-55px'});
                                }, 3000);
                            }
                            $('#formchangedalert').text(data.response);
                            $('#formchangedalert').show();
                            console.log(data.response);
                        })
                        .fail(function(data) {
                            console.log(data);
                        })
                        .always(function(data) {
                            console.log(data);
                            $('.loader-notif').hide();
                            $('.loader-notif').css({'top' : '-55px'});
                        });

                return false;
            });
            $('.modal-change').click(function(){
                alert
                $('#modal-changepw').css({'display' : 'block'});
                $('.lean-overlay').css({'display' : 'block'});
                $('#formchangedalert').hide();
            });

        });
    </script>
{% endblock %}


