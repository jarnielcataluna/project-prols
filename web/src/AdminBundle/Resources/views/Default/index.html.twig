{% import 'AdminBundle:Default:notification.html.twig' as notif %}
{% set userbdaynames = userbdaynames|default([]) %}

<!doctype html>
<html class="no-js" lang="">
{% block head %}
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Propelrr Log-in System| Home</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="{{ asset('prols2/css/select2.min.css') }}" rel="stylesheet" />
    <link href="{{ asset('prols2/css/pikaday.css') }}" rel="stylesheet" />
    <link rel="stylesheet" href="{{asset('prols2/css/fullcalendar/fullcalendar.css')}}" media="all"/>
    <link rel="stylesheet" href="{{asset('prols2/css/style.css')}}" media="all"/>
    <link rel="stylesheet" href="{{asset('prols2/css/_mon.css')}}" media="all"/>


</head>
{% endblock %}

<body>
{{ notif.notif_loader() }}
{{ notif.request_leave_notif }}
{{ notif.request_meeting_notif }}
<section id="main-container">

    <header>
    </header>
    {#{% if checkipdata == 1 %}#}
        {#{% if timename == false %}#}
        {#<div class="col-md-12 red center-align light-red darken-1 close-alert" style="position: absolute; bottom: 0; width: 100%; z-index: 5;">#}
                {#<div class="checkip"><h5 style="color: white;">You are now working outside the office</h5></div>#}
        {#</div>#}
            {#{% endif %}#}
        {#{% endif %}#}
    <section id="main-wrapper">
        <div class="container-fluid">
        <div class="row">

            <div class="col-md-12 green center-align timein-notif-container light-green darken-1 close-alert notification-modal" >
                <div class="timein-success"><h5>Time-in Successful!</h5></div>
            </div> 

            <div class="col-md-12 green center-align timeout-notif-container light-green darken-1 close-alert notification-modal">
                <div class="timeout-success"><h5>Time-out Successful!</h5></div>
            </div>                                                                                           

            <div class="nav-right z-depth-1">
                <div class="company-logo"><img src="{{asset('prols2/img/propelrrlogo.png')}}" style="border:1px solid #e0e0e0; border-radius:50%";></div>
                <div class="rightpanel">    
                    <div class="clock"> <div class="widget-big-int plugin-clock">00:00</div>
                        <div class="widget-subtitle plugin-date">Loading...</div>
                    </div>

                    <a class="waves-effect waves-light btn-flat red btn-large btn-timeout" style="display:none;"><i class="material-icons left">query_builder</i>Time Out</a>

                    <br>
                    <div class="chip timechip" style="display: none">
                        Timed-in at {{currenttimein}}
                    </div>
                    <!-- <div class="chip timed-in">
                        Timed-in
                    </div> -->
                    

                        
                </div>
                
                <div class="clr"></div>

            {% block nav %}
                <div class="collection emp-nav">
                    <a href="{{ path('admin_homepage') }}" class="collection-item active"><i class="material-icons nav-icon">reorder</i> Home</a>
                    <a href="{{ path('profile_page') }}" class="collection-item"><i class="material-icons nav-icon">perm_identity</i> Profile</a>
                    <!-- <a href="notif.html" class="collection-item"><i class="material-icons nav-icon">chat_bubble_outline</i> Notification <span class="new badge">2</span></a> -->
                    
                </div>

               <div class="collection admin-nav">
                    {% if role == 'ADMIN' %}
                    <a href="{{ path('manage_employee') }}" class="collection-item"><i class="material-icons nav-icon">list</i> Manage Employees</a>
                    {#<a href="{{ path('view_request') }}" class="collection-item"><i class="material-icons nav-icon">view_agenda</i> View Requests {% if requestcount != 0 %}<span class="new badge">{{ requestcount }}</span>{% endif %}</a>#}
                    {% endif %}
                </div>

                <div class="collection logout-nav">
                    <a href="#!" class="collection-item btn-logout"><i class="material-icons nav-icon">input</i> Log out</a>
                </div>
            {% endblock %}
            </div>
{% block body %}
        <div class="page-content">
            <div class="col-md-12 light-blue darken-1 heading z-depth-1">
            <div class="responsive-nav"><a class="btn-flat"><i class="material-icons res-menu">reorder</i></a></div>
                <h3 class="center-align"><div class="widget-subtitle plugin-date">Loading...</div></h3>
            </div>

                <div class="col-md-12 content">
                    <!-- <div class="row"> -->
                        <div class="col-md-12"> 
                            <div id="alert_holder"></div>
                            <div class="calendar" href="#daily_agenda">
                                <div id="calendar"></div>
                            </div>
                        </div>
                    <!-- </div> -->                 
                </div>
        </div>


        <!-- Modal -->
        <div id="daily_agenda" class="modal modal-fixed-footer">
                
            <div class="modal-content">
                <h4>Daily Agenda</h4>
                {#<ul class="collection agenda-list">#}
                        {#<li class="collection-item avatar">#}
                            {#<i class="material-icons circle">perm_identity</i>#}
                            {#<span class="title">Mitchelle Viray</span>#}
                            {#<p>Meeting at 3PM</p>#}
                        {#</li>#}

                        {#<li class="collection-item avatar">#}
                            {#<i class="material-icons circle">perm_identity</i>#}
                            {#<span class="title">Dexter Loor</span>#}
                            {#<p>On vacation-leave</p>#}
                        {#</li>#}
                {#</ul>#}
                <div class="agenda-buttons">
                    <a class="waves-effect waves-light btn orange btn-reqmeeting">Request Meeting</a>
                    <a class="waves-effect waves-light btn orange btn-reqleave">Request Leave</a>
                </div>

                <div class="form-reqmeeting">
                    <div class="input-field">
                        <input id="meeting" placeholder="Type your message here...">
                    </div>
                    <a class="waves-effect waves-light btn amber btn-submitmeeting">Sumbit</a>
                    <div class="chip required-field">
                        required field!
                    </div>
                    <div class="chip sent">
                        sent!
                    </div>

                </div>

                <div class="form-reqleave">

                    <div class="input-field" style="padding-top: 30px;">
                        <div class="row" style="margin-bottom: 25px; margin-top: 10px;">

                            <select class="col-md-6" id="leavetype">
                                <option value=""disabled selected>Choose Type of Leave</option>
                                <option value="1">Sick Leave</option>
                                <option value="2">Vacation Leave</option>
                            </select>
                        </div>
                        <div class="row">

                        <div class="col-md-6">
                            <p style="margin-top: -25px; margin-bottom: -5px;">From: </p>
                            <input name="start-date" readonly placeholder="Start Date" class="start-date" id="datepicker">
                        </div>
                        <div class="col-md-6">
                            <p style="margin-top: -25px; margin-bottom: -5px;">To: </p>
                            <input name="end-date" readonly placeholder="End Date" class="end-date" id="datepicker2">

                        </div>
                        <div class="col-md-12">
                            <textarea id="reason-leave-sbt" class="materialize-textarea" placeholder="Reason...." style="text-align: center; margin-top: -10px;"></textarea>
                        </div>


                        {#<input name="group2" type="radio" id="sickleave"  checked/>#}
                        {#<label for="sickleave" class="lbl-info radio-lbl">Sick Leave</label>#}
                        {#<input name="group2" type="radio" id="vacationleave" />#}
                        {#<label for="vacationleave" class="lbl-info radio-lbl">Vacation Leave</label>#}


                        {#<div class="input-field s6 col-md-6">#}
                            {#<select class="browser-default">#}
                                {#<option value="" disabled selected>Type of Leave</option>#}
                                {#<option value="1">Sick Leave</option>#}
                                {#<option value="2">Vacation Leave</option>#}
                            {#</select>#}
                        {#</div>#}
                    </div>

                    </div>

                    <a class="waves-effect waves-light btn amber btn-submitleave" style="margin-top: 20px;">Sumbit</a>
                    <div class="chip required-field">
                        required field!
                    </div>
                    <div class="chip sent">
                        sent!
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat close-modal-agenda">Close</a>
            </div>

        </div>
       
        <!-- End of Modal -->

    </div>
    </div>
 {% endblock %}
    </section>
</section>
{{  include ('AdminBundle:Default:modal.html.twig') }}
    {% if checkip and timeflag == 0 %}
        <div class="time-in-container" style="display:none;">
            <div class="time-in center-align">
                <div class="valign-wrapper">

                    <div class="prompt" style="display:block; width:100%; float:none; clear:both;">
                        <div class="clock2"><div class="widget-big-int plugin-clock">00:00</div>
                        <div class="widget-subtitle plugin-date">Loading...</div></div>
                        {% if systime >= afternoon %}
                        <p class="confirm-timein">Good Afternoon!</p>
                        {% else %}
                        <p class="confirm-timein">Good Morning!</p>
                        {% endif %}
                        <div class="btn-block">
                            <a class="waves-effect waves-light green btn-flat btn-large btn-timein time-btn"
                               id="time-in-button" data-action="timein" data-id="{{ user.id }}" data-ip="{{ checkip }}">
                                <i class="material-icons left icon-timein">query_builder</i>Time in</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{#{% if isTimeout == 1 %}#}
    <div class="modal-container forgot-timeout-modal" style="display:none;">
        <div class="center-align" style="position: relative; top: 350px;">
            <div class="valign-wrapper">

                <div class="prompt auto-timeout-prompt" style="display:block; width:100%; float:none; clear:both;">
                        <p class="confirm-timein"><strong>It's another day!</strong></p>
                    <br>
                    <br>
                    <div class="btn-block">
                        <a class="waves-effect waves-light red btn-flat btn-large btn-timeout btn-timeout-newday" style="height: 54px; line-height: 55px; top: 0px;">
                            <i class="material-icons left">query_builder</i>Time Out</a>
                        &nbsp;
                        <a class="waves-effect waves-light green btn-flat btn-large forgot-timeout-btn btn-keep-working" style="color: white; ">
                            <i class="material-icons left">work</i>I'M STILL WORKING<span id="time">(30)</span></a>
                    </div>
                </div>

                <div class="prompt time-in-prompt" style="display:none; width:100%; float:none; clear:both;">

                    <div class="btn-block">

                    </div>
                </div>
            </div>
        </div>
    </div>

{#{% endif %}#}
        <div class="timeout-container">
            <div class="timeout center-align">
                <div class="valign-wrapper">
                    
                    <div class="prompt" style="display:block; width:100%; float:none; clear:both;">
                    <div class="clock2"><div class="widget-big-int plugin-clock">00:00</div>
                        <div class="widget-subtitle plugin-date">Loading...</div></div>
                        <p class="confirm-timeout">Are you sure you want to time-out?</p>
                            <div id="errormessage" style="color: #f44336; display:none;"><strong>Wrong Password</strong></div>
                            <input id="confirmpw-timeout" type="password" placeholder="Enter password...">

                            <div class="btn-block">
                                <a class="waves-effect waves-light green btn-flat btn-large btn-yes time-btn"
                                   id="time-out-button" data-action="timeout" data-id="{{ user.id }}" data-ip="{{ checkip }}">Yes</a> &nbsp;
                                <a class="waves-effect waves-light red btn-flat btn-large btn-cancel timeout-cancel">Cancel</a>
                            </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="logout-container">
        <div class="logout center-align">
            <div class="valign-wrapper">

                <div class="prompt" style="display:block; width:100%; float:none; clear:both;">
                    <p class="confirm-logout">Are you sure you want to log-out?</p>
                    <div class="btn-block">
                        <a class="waves-effect waves-light green btn-flat btn-large btn-yes-logout" href="{{ path('logout') }}">Yes</a>
                        <a class="waves-effect waves-light red btn-flat btn-large btn-cancel">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
        </div>
    {% if matchedip != userip and timeflag == 0%}
        <div class="diff-ip-container">
            <div class="diff-ip center-align">
                <div class="valign-wrapper">

                    <div class="prompt" style="display:block; width:100%; float:none; clear:both;">
                        <div class="clock2"><div class="widget-big-int plugin-clock">00:00</div>
                        <div class="widget-subtitle plugin-date">Loading...</div></div>
                        <p class="diff-ip-notice" style="font-weight:700">You logged in with a different IP Address!</p>
                        <textarea id="diffip-input-reason" class="materialize-textarea" style="width: 500px; color:white; text-align:center; font-weight:400" placeholder="Enter Message..."></textarea>
                        <!-- <p class="diff-ip-notice">Request Access?</p>
                        <p class="diff-ip-sent">Request Sent!</p>
                        <p class="diff-ip-reason">Enter reason:</p> -->

                        <div class="btn-block">
                            <a class="waves-effect waves-light green btn-flat btn-large btn-timein time-btn"
                               id="time-in-button" data-action = "timein" data-id="{{ user.id }}" data-ip="{{ checkip }}">
                                <i class="material-icons left icon-timein">query_builder</i>Time in</a>
                            <a class="waves-effect waves-light green btn-flat btn-large btn-ip-ok">OK</a>
                            <a class="waves-effect waves-light green btn-flat btn-large btn-ip-send">Send</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

<div class="modal-container auto-timeout-notice" style="display:none;">
    <div class="center-align" style="position: relative; top: 350px;">
        <div class="valign-wrapper">

            <div class="prompt auto-timeout-prompt" style="display:block; width:100%; float:none; clear:both;">
                <p class="confirm-timein">We have automatically timed out you!</p>
                <p class="confirm-timein" style="font-size: 24px">Timed out at <span class="auto-timeout-time-message">08/21/2016 12:00 AM</span></p>
                <p class="confirm-timein" style="font-size: 24px">Last Timed in at <span class="auto-timeout-time-message-2">{{ lasttimein }}</span></p>
                <br><br>
                <div class="btn-block">
                    <a class="waves-effect waves-light red btn-flat btn-large btn-forgot-timeout-show-timein" style="height: 54px; line-height: 55px; top: 0px;">
                        <i class="material-icons left">query_builder</i>Time In</a>
                </div>
            </div>
        </div>
    </div>
</div>
<footer></footer>
{% block scripts %}
    <script src="{{asset('prols2/js/jquery.min.js')}}"></script>
    <script src="{{asset('prols2/js/html5.js')}}"></script>
    <script src="{{asset('prols2/js/modernizr-2.8.3.min.js')}}"></script>
    <script type="text/javascript" src="{{asset('prols2/js/plugins/bootstrap/bootstrap.min.js')}}"></script>
    <script src="{{asset('prols2/js/materialize.js')}}"></script>
    <script src="{{asset('prols2/js/script.js')}}"></script>
    <script type="text/javascript" src="{{asset('prols2/js/plugins/moment.min.js')}}"></script>
    <script type="text/javascript" src="{{asset('prols2/js/plugins/fullcalendar/fullcalendar.min.js')}}"></script>
    <script type="text/javascript" src="{{asset('prols2/js/plugins.js')}}"></script>
    <script type="text/javascript" src="{{asset('prols2/js/customscript.js')}}"></script>
    <script type="text/javascript" src="{{asset('prols2/js/pikaday.js')}}"></script>
{% endblock %}
{% block customjs %}
    <script>
        var picker = new Pikaday({ field: $('#datepicker')[0] });
        var picker = new Pikaday({ field: $('#datepicker2')[0] });
    </script>
{% endblock %}

<script type="text/javascript">
    var isTimeout   = '{{ app.session.get('timeout')|default('') }}';
    var dayNow      = '{{ app.session.get('isSameDay')|default('') }}';

    function timeOutInit() {
        //--------------12 AM ALERT MODAL-------------------------
        var alertInt    = isTimeout == 'false' ? setTimeout(breakTime, 1000) : setTimeout(checkTimeout, 1000);
        var displayTime = 30;
        var display     = document.querySelector('#time');

        function breakTime() {
            /* Set Alert Hour in 24hr Notation */
            var alertHour = 0;
            /* Set Alert Minute */
            var alertMinute = 0;
            /* Set Alert Minute */
            var alertSec = 0;
            /* Set time for alert timeout */
            var theDate = new Date();

            //if 12am
            if ((Math.abs(theDate.getHours()) == alertHour && Math.abs(theDate.getMinutes()) == alertMinute
                    && Math.abs(theDate.getSeconds()) == alertSec)) {
                this.focus();
                clearTimeout(alertInt);
                alert('Good Morning!');
                $('.forgot-timeout-modal').show();
                startTimer(displayTime, display);
            //if 1am onwards
            } else if(dayNow == 'false') {
                $('.forgot-timeout-modal').show();
                startTimer(displayTime, display);
            //else run loop
            } else {
                alertInt = setTimeout(breakTime, 50);
            }

            //console.log('time-trigger');
        }

        function checkTimeout() {
            if(isTimeout == 'false') {
                $('.forgot-timeout-modal').show();
                startTimer(displayTime, display);
            }
            console.log('isTimeout? '+isTimeout);
        }

        function checkIf_AutoTimeOut() {
            var isAutoTimeOut = "{{ app.request.query.get('timeout_qry') }}";
            var timeOutDate = "{{ app.request.query.get('timeout_date') }}";

            $d = new Date(timeOutDate);
            var options = {
                year: "numeric", month: "short",
                day: "numeric", hour: "2-digit", minute: "2-digit"
            };
            $d = $d.toLocaleTimeString("en-us", options);
            if(isAutoTimeOut == 'true') {
                $('.auto-timeout-notice').show();
                $('.auto-timeout-time-message').html($d);
                $('.time-in-container').hide();
                toggleTimeWidget('hide');
            }
        }

        $('.forgot-timeout-btn').click(function () {
            $('.forgot-timeout-modal').hide();
            timer = 0;
            checker = true;
            isTimeout = '{{ app.session.get('timeout', 'true') }}'
        });

        //----------------BUTTON-TIMER--------------------
        var checker = false;
        var timer, seconds, timerInt = null;

        function startTimer(duration, display) {
            timer = duration, seconds;
            timerInt = setInterval(function () {
                //minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                //minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                display.innerHTML = "(<b style='font-size: 18px'>" + (seconds - 1) + "</b>)";

                if (--timer < 0) timer = 0;

                if (seconds == 0 && checker == false) {
                    checker = true;

                    display.textContent = '';
                    $('.forgot-timeout-modal').hide();
                    manage_time_newday('timeout');
                }
            }, 1000);
        }

        function manage_time_newday(type) {
            var url = '{{ path('admin_manage_working_time_new_day', {type: 'timeout'}) }}';
            if(type == 'working') {
                url = '{{ path('admin_manage_working_time_new_day', {type: 'working'}) }}';
            }

            $.getJSON( url,
                    function( data ) {
                        if(type == 'working') toggleTimeWidget('show');
                        else  toggleTimeWidget('hide');
                    })
                    .fail( function() {
                        $('.modal-fail-ajax-container').show();
                    });
        }

        $('.btn-keep-working').bind('click', function() {
            manage_time_newday('working');
        });

        $('.btn-timeout-newday').bind('click', function() {
            $('.timeout-cancel').click(function() {
                clearInterval(timerInt);
                display.innerHTML = '(<b  style="font-size: 18px">'+displayTime+'</b>)';
                $('.forgot-timeout-modal').show();
                startTimer(displayTime, display);
            });
        });

        $('.btn-forgot-timeout-show-timein').bind('click', function() {
            $('.auto-timeout-notice').hide();
            toggleTimeInModal('show');
        });

        checkIf_AutoTimeOut();
    }

    window.onload = function () {
        timeOutInit();
    };
</script>

<script>

    function toggleTimeWidget(act) {
        if(act == 'show') {
            $('.timed-in').show();
            $('.btn-timeout').show();
            $('.timechip').show();
        } else {
            $('.timed-in').hide();
            $('.btn-timeout').hide();
            $('.timechip').hide();
        }
    }

    function toggleTimeInModal(act) {
        if(act == 'show') {
            $('.time-in-container').show();
            $('.btn-timeout').hide();
        }
    }

    initWidget = function() {
        if((dayNow == '' || dayNow == 'true') && '{{ isTimeoutAlready }}' != 'true') {
            toggleTimeWidget('show');

        } else if(dayNow == '' && isTimeout == '') {

            toggleTimeInModal('show');
        }

        if('{{ isTimeoutAlready }}' == 'true'){
            toggleTimeWidget('hide');
        }

    }
//    console.log('dayNow = ' + dayNow)
//    console.log('isTimeout = ' + isTimeout)

    initWidget();


    $('select').material_select();
    $('.caret').hide();
    {#$.post( "{{ path('check_timein') }}", {}, function(data) {#}

    {#}).always(function(data) {#}
        {#console.log(data)#}
        {#var res = parseInt(data);#}
        {#if(res == 1) {#}
            {#console.log('ok')#}
            {#$('.time-in-container').hide();#}
            {#$('.btn-timeout').show();#}
            {#$('.timechip').show();#}
        {#}else{#}
            {#$('.time-in-container').show();#}
            {#$('.btn-timeout').hide();#}
        {#}#}
    {#});#}
    var pass = ''

{#$('.time-btn').click(function(e){#}
            {#e.preventDefault();#}
            {#var message = $('#diffip-input-reason').val(), error = false,#}
                    {#user_ip =  $('#time-in-button').data('ip'),#}
                    {#is_message = undefined, action = $(this).data('action'), pass;#}
            {#if(user_ip == 0){#}
                {#if(message == ''){#}
                    {#$('#diffip-input-reason').css({'border-color': '#f44336'});#}
                    {#error = true;#}
                {#}#}
                {#is_message = true;#}
                {#if(error){#}
                    {#return false;#}
                {#}#}
            {#}#}
            {#var id = $('#time-in-button').data('id'), timename = $('#time-in-button').data('time');#}

            {#if(action == 'timeout'){#}
                {#pass = $('#confirmpw-timeout').val();#}
                {#if(pass == ''){#}
                    {#pass = 'null';#}
                    {#$('#confirmpw-timeout').closest('.timeout').find('input[type=password]').css({'border-bottom-color' : '#f44336'});#}
                    {#$('#errormessage').hide();#}
                    {#return false;#}
                {#}#}
            {#} else if(action == 'timein' && user_ip == 0) {#}
                {#message = message.replace(/(?:\r\n|\r|\n)/g, '<br>');#}
            {#}#}
            {#$('.loader-notif').show();#}
            {#$('.loader-notif').css({'top' : '0px'});#}
                {#$.post("{{ path('admin_time_in_no_params') }}" + id + '/' + pass, {is_message: is_message, message:message} ,  function(data){#}
                    {#console.log(data)#}
                    {#console.log(data);#}
                        {#if(data == 1 || data == 6){#}
                           {#$('.time-in-container').css({'display' : 'none'});#}
                            {#$('.timein-notif-container').css({'top':'0px'});#}
                            {#$('.timed-in').css({'display' : 'block'});#}
                            {#$('.btn-timeout').show();#}
                            {#$('.diff-ip-container').hide();#}
                            {#showBirthday();#}
                            {#setTimeout(function(){#}
                                {#$('.timein-notif-container').css({'top' : '-55px'});#}

                            {#}, 5000);#}
                        {#} else if(data == 2){#}
                            {#$('.timeout-container').css({'display' : 'none'});#}
                            {#$('.timeout').css({'display' : 'none'});#}
                            {#$('.timeout-notif-container').css({'top':'0px'});#}
{#//                            $('.timed-in').css({'display' : 'none'});#}
                            {#$('.timed-out').css({'display' : 'block'});#}
                            {#$('.btn-timeout').css({'display' : 'none'});#}
                            {#$('.timechip').hide();#}
                            {#setTimeout(function(){#}
                                {#$('.timeout-notif-container').css({'top' : '-55px'});#}
                            {#}, 5000);#}
                        {#} else if(data == 5){#}

                        {#}else if(data.error == true && action == 'timeout'){#}
                        {#$('#confirmpw-timeout').closest('.timeout').find('input[type=password]').css({'border-bottom-color' : '#f44336'});#}
                        {#$('#errormessage').show();#}
                        {#}#}

                        {#// else if(data== 0){#}
                        {#//     $('.time-in-container').css({'display' : 'none'});#}
                        {#//     $('.diff-ip-container').show();#}
                        {#//    // $('#mb-wrongip').addClass('open');#}
                        {#//     // $('#mb-timein').modal().hide();#}
                        {#//     $('#mb-wrongip').modal('show');#}
                        {#// }#}
                {#}, "json").fail(function(data)#}
                {#{#}

                    {#console.log(data);#}
                      {#$('.time-in-container').hide();#}
                      {#$('.timeout-container').hide();#}
                      {#$('.modal-logout-notify-container').show();#}
{#//                      $('.modal-session-content').show();#}

                {#}).always(function(data){#}
                    {#$('.loader-notif').hide();#}
                    {#$('.loader-notif').css({'top' : '-55px'});#}
                {#});#}



       {#});#}

$('#time-in-button').click(function(){
    var message = $('#diffip-input-reason').val(), error = false,
    user_ip =  $('#time-in-button').data('ip'),
    is_message = undefined, action = $(this).data('action'), pass;
    if(user_ip == 0){
        message = message.replace(/(?:\r\n|\r|\n)/g, '<br>')
        if(message == ''){
            $('#diffip-input-reason').css({'border-color': '#f44336'});
            error = true;
        }
        is_message = true;
        if(error){
            return false;
        }
    }
    $('#time-in-button').hide();
    $('.loader-notif').show();
    $('.loader-notif').css({'top' : '0px'});
    $('.forgot-timeout-modal').hide();
    $.post("{{ path('time_in') }}", {is_message : is_message, message : message }, function(data){
        console.log(data);
        toggleTimeWidget('show');
        $('.time-in-container').css({'display' : 'none'});
        $('.timein-notif-container').css({'top':'0px'});
        $('.timed-in').css({'display' : 'block'});
        $('.btn-timeout').show();
        $('.diff-ip-container').hide();
        showBirthday();
        setTimeout(function(){
            $('.timein-notif-container').css({'top' : '-55px'});

        }, 5000);
    }).always(function(data){
        console.log(data);
        $('.loader-notif').hide();
        $('.loader-notif').css({'top' : '-55px'});
    });
});

$('#time-out-button').click(function(){
    var pass = $('#confirmpw-timeout').val();

    //check if password is empty
    if(pass == ''){
        $('#confirmpw-timeout').closest('.timeout').find('input[type=password]').css({'border-bottom-color' : '#f44336'});
        return;
    }

    $('.loader-notif').show();
    $('.loader-notif').css({'top' : '0px'});
    $('#time-out-button').hide();
    $('.timeout-cancel').hide();
    $.post("{{ path('time_out') }}" + pass, function(data){
        toggleTimeWidget('hide');
            //validate password
        if(data == true) {
            $('#time-out-button').show();
            $('.timeout-cancel').show();
            $('#confirmpw-timeout').closest('.timeout').find('input[type=password]').css({'border-bottom-color': '#f44336'});
            $('#errormessage').show();
            return;
        }
            //time out success
        $('.timeout-container').css({'display' : 'none'});
        $('.timeout').css({'display' : 'none'});
        $('.timeout-notif-container').css({'top':'0px'});
        //                            $('.timed-in').css({'display' : 'none'});
        $('.timed-out').css({'display' : 'block'});
        $('.btn-timeout').css({'display' : 'none'});
        $('.timechip').hide();
        setTimeout(function(){
            $('.timeout-notif-container').css({'top' : '-55px'});
        }, 5000);
    }).always(function(data){
        console.log(data);
        $('.loader-notif').hide();
        $('.loader-notif').css({'top' : '-55px'});
    }).fail(function(data){
        console.log(data);
        $('.time-in-container').hide();
        $('.timeout-container').hide();
        $('.modal-logout-notify-container').show();
        //                      $('.modal-session-content').show();
    });

});

$('.btn-submitmeeting').click(function(){
   var reqmeetmessage =  $('#meeting').val();
    if(reqmeetmessage == ''){
        $('#meeting').css({'border-color' : 'red'});
        setTimeout(function(){
            $('#meeting').css({'border-color': 'gray'})
        }, 1000);
        $('.required-field').show();
        return;
    }
    $('.loader-notif').show();
    $('.loader-notif').css({'top' : '0px'});
    $('.btn-submitmeeting').hide();
    $.post("{{ path('request_meeting') }}", {reqmeetmessage:reqmeetmessage}, function(data){
       console.log(data);
        $('#meeting').val('');
        $('.required-field').hide();
        $('#daily_agenda').closeModal();
        $('.request-meeting-notif').css({'top':'0px'});
        setTimeout(function(){
            $('.request-meeting-notif').css({'top' : '-55px'});
        }, 5000);
    }).always(function(data){
        console.log(data);
        $('.loader-notif').hide();
        $('.loader-notif').css({'top' : '-55px'});
        $('.btn-submitmeeting').show();
    });
});

$('.btn-submitleave').click(function(){
    var typeleave = '';
    var e = document.getElementById("leavetype");

    typeleave = e.options[e.selectedIndex].value;

    var leavestartdate  = $('.start-date').val();
    var leaveenddate    = $('.end-date').val();
    var reasonleave = $('#reason-leave-sbt').val();
    if(leavestartdate == '' || leaveenddate == '' || reasonleave == ''){
        if(typeleave == ''){
            $('.select-dropdown').css({'border-color' : 'red'});
            setTimeout(function(){
                $('.select-dropdown').css({'border-color': 'gray'})
            }, 1000);

        }
        if(leavestartdate == ''){
            $('.start-date').css({'border-color': 'red'});
            setTimeout(function(){
                $('.start-date').css({'border-color': 'gray'})
            }, 1000);
        }
        if(leaveenddate == ''){
            $('.end-date').css({'border-color': 'red'});
            setTimeout(function(){
                $('.end-date').css({'border-color': 'gray'})
            }, 1000);
        }
        if(reasonleave == ''){
            $('#reason-leave-sbt').css({'border-color': 'red'});
            setTimeout(function(){
                $('#reason-leave-sbt').css({'border-color': 'gray'})
            }, 1000);
        }
        $('.sent').hide();
        $('.required-field').show();
        return;
    }
    $('.loader-notif').show();
    $('.loader-notif').css({'top' : '0px'});
    $('.btn-submitleave').hide();
    $.post("{{ path('request_leave') }}", {leavestartdate:leavestartdate, leaveenddate:leaveenddate,
        reasonleave:reasonleave, typeleave:typeleave}, function(data){
        console.log(data);
        $('.start-date').val('');
        $('.end-date').val('');
        $('#reason-leave-sbt').val('');
        $('#leavetype').val('');

        $('.required-field').hide();
//        $('.sent').show();
        $('#daily_agenda').closeModal();
        $('.request-leave-notif').css({'top':'0px'});
        setTimeout(function(){
            $('.request-leave-notif').css({'top' : '-55px'});
        }, 5000);
    }).always(function(data){
        console.log(data);
        $('.loader-notif').hide();
        $('.loader-notif').css({'top' : '-55px'});
        $('.btn-submitleave').show();
    });

});

{#$('.time-btn').click(function(e){#}
            {#e.preventDefault();#}
            {#var message = $('#diffip-input-reason').val(), error = false,#}
                    {#user_ip =  $('#time-in-button').data('ip'),#}
                    {#is_message = undefined, action = $(this).data('action'), pass;#}
            {#if(user_ip == 0){#}
                {#if(message == ''){#}
                    {#$('#diffip-input-reason').css({'border-color': '#f44336'});#}
                    {#error = true;#}
                {#}#}
                {#is_message = true;#}
                {#if(error){#}
                    {#return false;#}
                {#}#}
            {#}#}
            {#var id = $('#time-in-button').data('id'), timename = $('#time-in-button').data('time');#}

            {#if(action == 'timeout'){#}
                {#pass = $('#confirmpw-timeout').val();#}
                {#if(pass == ''){#}
                    {#pass = 'null';#}
                    {#$('#confirmpw-timeout').closest('.timeout').find('input[type=password]').css({'border-bottom-color' : '#f44336'});#}
                    {#$('#errormessage').hide();#}
                    {#return false;#}
                {#}#}
            {#} else if(action == 'timein' && user_ip == 0) {#}
                {#message = message.replace(/(?:\r\n|\r|\n)/g, '<br>');#}
            {#}#}
            {#$('.loader-notif').show();#}
            {#$('.loader-notif').css({'top' : '0px'});#}
                {#$.post("{{ path('admin_time_in_no_params') }}" + id + '/' + pass, {is_message: is_message, message:message} ,  function(data){#}
                    {#console.log(data)#}
                    {#console.log(data);#}
                        {#if(data == 1 || data == 6){#}
                           {#$('.time-in-container').css({'display' : 'none'});#}
                            {#$('.timein-notif-container').css({'top':'0px'});#}
                            {#$('.timed-in').css({'display' : 'block'});#}
                            {#$('.btn-timeout').show();#}
                            {#$('.diff-ip-container').hide();#}
                            {#showBirthday();#}
                            {#setTimeout(function(){#}
                                {#$('.timein-notif-container').css({'top' : '-55px'});#}

                            {#}, 5000);#}
                        {#} else if(data == 2){#}
                            {#$('.timeout-container').css({'display' : 'none'});#}
                            {#$('.timeout').css({'display' : 'none'});#}
                            {#$('.timeout-notif-container').css({'top':'0px'});#}
{#//                            $('.timed-in').css({'display' : 'none'});#}
                            {#$('.timed-out').css({'display' : 'block'});#}
                            {#$('.btn-timeout').css({'display' : 'none'});#}
                            {#$('.timechip').hide();#}
                            {#setTimeout(function(){#}
                                {#$('.timeout-notif-container').css({'top' : '-55px'});#}
                            {#}, 5000);#}
                        {#} else if(data == 5){#}

                        {#}else if(data.error == true && action == 'timeout'){#}
                        {#$('#confirmpw-timeout').closest('.timeout').find('input[type=password]').css({'border-bottom-color' : '#f44336'});#}
                        {#$('#errormessage').show();#}
                        {#}#}

                        {#// else if(data== 0){#}
                        {#//     $('.time-in-container').css({'display' : 'none'});#}
                        {#//     $('.diff-ip-container').show();#}
                        {#//    // $('#mb-wrongip').addClass('open');#}
                        {#//     // $('#mb-timein').modal().hide();#}
                        {#//     $('#mb-wrongip').modal('show');#}
                        {#// }#}
                {#}, "json").fail(function(data)#}
                {#{#}
                  {#if(data.status == 401){#}
                      {#$('.time-in-container').hide();#}
                      {#$('.timeout-container').hide();#}
                      {#$('.modal-logout-notify-container').show();#}
{#//                      $('.modal-session-content').show();#}
                  {#}#}
                {#}).always(function(data){#}
                    {#$('.loader-notif').hide();#}
                    {#$('.loader-notif').css({'top' : '-55px'});#}
                {#});#}
       {#});#}
$('.btn-ip-cancel').click(function(e){
e.preventDefault();
$('.diff-ip-container').hide();
});
$('.btn-ip-yes').click(function(e){
e.preventDefault();
$('.diff-ip-reason').show();
});

$('.modal-trigger').leanModal();



function showBirthday() {

var bdaynames = [];
{% for names in userbdaynames %}
bdaynames.push("{{ names }}");
{% endfor %}
console.log(bdaynames);
if(bdaynames.length) {
$('.modal-birthday-notify-container').show();
}

$('.btn-bdayclose').click( function() {
$('.modal-birthday-notify-container').hide();
});
}

</script>
</body>
</html>
